<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>ODC2011 - All-Ireland planning application</title>

	<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.13/themes/base/jquery-ui.css" type="text/css" media="all" />

	<style type="text/css" media="screen">
		body { font-family: Verdana,Arial,sans-serif;}
		#map { height: 300px; width: 400px; float: left; }
		#palist { margin: 1em; font-size: 80%;}
		#yearrange { margin: 1em; width: 500px;}
		#yearsel { font-size: 300%; border: 0; width: 500px; text-align: center;}
	</style>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js" type="text/javascript"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.13/jquery-ui.min.js" type="text/javascript"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.13/i18n/jquery-ui-i18n.min.js" type="text/javascript"></script>

    <script type="text/javascript">

	var map;
	var svmap;
	var currentMarkers = new Array();

	// GPlan status based on GPlan_ApplicationStatus.txt
	var APPLICATION_STATUS = {
	 "0":"INCOMPLETED APPLICATION",
	 "1":"NEW APPLICATION",
	 "2":"FURTHER INFORMATION",
	 "3":"DECISION MADE",
	 "4":"LEAVE TO APPEAL",
	 "5":"APPEALED",
	 "8":"WITHDRAWN",
	 "9":"APPLICATION FINALISED",
	 "10":"PRE-VALIDATION",
	 "11":"DEEMED WITHDRAWN",
	 "12":"APPEALED FINANCIAL"
	};

	// this is dummy data, I made it up based on exitings PA, but the schema should be used:
	var data = [
		{appref:'a',lat:53.270,lng:-9.104,appdate:2000,appstatus:8},
		{appref:'b',lat:53.270,lng:-9.104,appdate:2001,appstatus:3}
	];
	
	function fitMap(){
		$("#map").width($(window).width()*0.8);
		$("#map").height($(window).height()*0.6);
	}

	function makemap() {
		var mapCenter = new google.maps.LatLng(53.27, -9.104);

		var mapOptions = { 
			zoom: 19,
			center: mapCenter,
			mapTypeId: google.maps.MapTypeId.HYBRID,
			overviewMapControl: true,
			overviewMapControlOptions: {
				position: google.maps.ControlPosition.BOTTOM_RIGHT,
				opened: true
			}
		};

		var panoramaOptions = {
			position: mapCenter,
			pov: {
				heading: 170,
				pitch: 10,
				zoom: 1
			}
		};

		map = new google.maps.Map(document.getElementById("map"), mapOptions);

		for (i=0; i < data.length; i++) {
			addMarker(data[i]);
		}
		
	}

	function addMarker(record) {
		pos = new google.maps.LatLng(record.lat, record.lng);

		for(i in currentMarkers){
			
			apos = currentMarkers[i].marker.getPosition();
			
			if(pos.equals(apos)) {
				pos = new google.maps.LatLng(record.lat + 0.00001, record.lng + 0.00001);
			}
		}
		
		
		
		
		(function(r) {
			// marker size is 30x32
			var yMarkerImage = new google.maps.MarkerImage("img/year-marker-"+ r.appstatus +"-"+ r.appyear +".png");

			marker = new google.maps.Marker({
				position: pos,
				map: map,
				icon: yMarkerImage,
				title: APPLICATION_STATUS[r.appstatus]
			});
			
			google.maps.event.addListener(marker, "click", function() {
				document.location = '#_' + r.appref;
			});
			
			currentMarkers.push({ id:r.appref, year:r.appyear, marker:marker });
			$("#palist").append("<div>" + r.appref + ": " + APPLICATION_STATUS[r.appstatus] + "</div>");
			
		})({'appyear':record.appdate, 'appstatus':record.appstatus, 'appref':record.appref});
	}
	
	function yearsel(){
		$("#yearrange").slider({
			range: true,
			min: 2000,
			max: 2010,
			values: [ 2000, 2010 ],
			slide: function(event, ui) {
				$("#yearsel").val(ui.values[0] + " - " + ui.values[1]);
				filterPA(ui.values[0], ui.values[1]);
			}
		});
		
		$("#yearsel").val($("#yearrange").slider("values", 0) + " - " + $("#yearrange").slider("values", 1 ));
		$("#yearsel").attr('readonly', true);
		
	}
	
	function filterPA(miny, maxy){
		for(i in currentMarkers){
			if((currentMarkers[i].year >= miny) && ( currentMarkers[i].year <= maxy)) {
				currentMarkers[i].marker.setVisible(true);
			}
			else {
				currentMarkers[i].marker.setVisible(false);
			}
		}
	}
	

	$(function() { 
		makemap(); 
		yearsel();
		fitMap();
		$(window).resize(function() {
			fitMap(); 
		});
	});
</script>
</head>

<body>
	<div id="debug"></div>
	<div id="yearrange"></div>
	<input id="yearsel" />
	<div id="map"></div><div id="palist"></div>
</body>
</html>
